<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Golf - Complete System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect } = React;

// Icons
const Trophy = ({ className = "" }) => (<svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>);
const RefreshCw = ({ className = "" }) => (<svg className={className} width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>);
const Users = ({ className = "" }) => (<svg className={className} width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
const TrendingUp = ({ className = "" }) => (<svg className={className} width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>);
const Calendar = ({ className = "" }) => (<svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>);
const BarChart = ({ className = "" }) => (<svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>);
const Save = ({ className = "" }) => (<svg className={className} width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>);
const Trash = ({ className = "" }) => (<svg className={className} width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>);

function App() {
    const [currentTab, setCurrentTab] = useState('live');
    const [teams] = useState([
        { id: 1, name: 'Nolan Kouba 1', players: ['Scottie Scheffler', 'Akshay Bhatia', 'Min Woo Lee', 'Emiliano Grillo', 'Luke Clanton', 'Seamus Power'] },
        { id: 2, name: 'Nolan Kouba 2', players: ['Ludvig Aberg', 'Akshay Bhatia', 'Rasmus Hojgaard', 'Aldrich Potgieter', 'Tom Hoge', 'Keith Mitchell'] },
        { id: 3, name: 'Nolan Kouba 3', players: ['Rory McIlroy', 'Collin Morikawa', 'Tom Hoge', 'Keith Mitchell', 'Adam Hadwin', 'Jackson Koivun'] }
    ]);
    const [leaderboardData, setLeaderboardData] = useState([]);
    const [loading, setLoading] = useState(false);
    const [tournamentInfo, setTournamentInfo] = useState({ name: 'Loading...', isMajor: false });
    const [lastUpdate, setLastUpdate] = useState(null);
    const [autoRefresh, setAutoRefresh] = useState(true);
    const [tournamentHistory, setTournamentHistory] = useState([]);
    const [selectedHistoryId, setSelectedHistoryId] = useState(null);

    const MADE_CUT_BONUS = { regular: 20, major: 50 };
    const MAJOR_TOURNAMENTS = ['Masters', 'PGA Championship', 'U.S. Open', 'The Open'];

    useEffect(() => {
        const saved = localStorage.getItem('fantasyGolfTournaments');
        if (saved) {
            try { setTournamentHistory(JSON.parse(saved)); } catch (e) {}
        }
    }, []);

    const getPositionPoints = (position, isMajor) => {
        const posNum = parseInt(position.replace(/[^0-9]/g, ''));
        if (!posNum) return 0;
        const regularScoring = {1:125,2:95,3:90,4:85,5:80,6:75,7:70,8:65,9:60,10:55,11:54,12:53,13:52,14:51,15:50,16:49,17:48,18:47,19:46,20:45,21:44,22:43,23:42,24:41,25:40,26:39,27:38,28:37,29:36,30:35,31:34,32:33,33:32,34:31,35:30,36:29,37:28,38:27,39:26,40:25,41:24,42:23,43:22,44:21,45:20,46:19,47:18,48:17,49:16,50:15,51:14,52:13,53:12,54:11,55:10,56:9,57:8,58:7,59:6,60:5};
        const majorScoring = {1:175,2:140,3:135,4:130,5:125,6:120,7:115,8:110,9:105,10:100,11:95,12:90,13:85,14:80,15:75,16:74,17:73,18:72,19:71,20:70,21:69,22:68,23:67,24:66,25:65,26:64,27:63,28:62,29:61,30:60,31:59,32:58,33:57,34:56,35:55,36:54,37:53,38:52,39:51,40:50,41:48,42:46,43:44,44:42,45:40,46:38,47:36,48:34,49:32,50:30,51:28,52:26,53:24,54:22,55:20,56:18,57:16,58:14,59:12,60:10};
        return (isMajor ? majorScoring : regularScoring)[posNum] || 0;
    };

    const fetchLeaderboard = async () => {
        setLoading(true);
        try {
            const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/golf/pga/scoreboard');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            if (data?.events?.length > 0) {
                const event = data.events[0];
                const tournamentName = event.name || 'PGA Tournament';
                const isMajor = MAJOR_TOURNAMENTS.some(major => tournamentName.includes(major));
                setTournamentInfo({ name: tournamentName, isMajor });
                if (event.competitions?.[0]?.competitors) {
                    const competitors = event.competitions[0].competitors;
                    const players = competitors.map((c, idx) => {
                        const score = c.score || 'E';
                        let position = (idx + 1).toString();
                        if (idx > 0 && competitors[idx-1].score === c.score) position = 'T' + position;
                        const madeCut = c.linescores && c.linescores.length >= 3;
                        let thru = 'F';
                        if (c.linescores?.length > 0) {
                            const lastRound = c.linescores[c.linescores.length - 1];
                            thru = lastRound.period >= 3 ? 'F' : `R${lastRound.period}`;
                        }
                        return { name: c.athlete?.displayName || c.athlete?.fullName || 'Unknown', position, score, madeCut, thru };
                    });
                    if (players.length > 0) {
                        setLeaderboardData(players);
                        setLastUpdate(new Date());
                    }
                }
            }
        } catch (err) { console.error('Error:', err); } finally { setLoading(false); }
    };

    useEffect(() => { fetchLeaderboard(); }, []);
    useEffect(() => {
        if (!autoRefresh) return;
        const interval = setInterval(() => { fetchLeaderboard(); }, 60000);
        return () => clearInterval(interval);
    }, [autoRefresh]);

    const getPlayerScore = (playerName, playerData = leaderboardData, isMajor = tournamentInfo.isMajor) => {
        const normalizedSearch = playerName.toLowerCase().replace(/[^a-z\s]/g, '');
        const player = playerData.find(p => {
            const normalizedPlayer = p.name.toLowerCase().replace(/[^a-z\s]/g, '');
            return normalizedPlayer.includes(normalizedSearch) || normalizedSearch.includes(normalizedPlayer);
        });
        if (!player) return { points: 0, position: 'N/A', score: '-', madeCut: false, thru: '-' };
        let points = getPositionPoints(player.position, isMajor);
        if (player.madeCut) points += (isMajor ? MADE_CUT_BONUS.major : MADE_CUT_BONUS.regular);
        return { points, position: player.position, score: player.score, madeCut: player.madeCut, thru: player.thru };
    };

    const calculateTeamScore = (team, playerData = leaderboardData, isMajor = tournamentInfo.isMajor) => {
        return team.players.reduce((total, playerName) => total + getPlayerScore(playerName, playerData, isMajor).points, 0);
    };

    const getTotalMadeCut = (team) => team.players.filter(playerName => getPlayerScore(playerName).madeCut).length;

    const saveTournament = () => {
        if (!tournamentInfo.name || leaderboardData.length === 0) {
            alert('No tournament data to save!');
            return;
        }
        const tournamentData = {
            id: Date.now(),
            name: tournamentInfo.name,
            date: new Date().toISOString(),
            isMajor: tournamentInfo.isMajor,
            players: leaderboardData,
            teamScores: teams.map(team => ({
                teamId: team.id,
                teamName: team.name,
                score: calculateTeamScore(team),
                players: team.players.map(playerName => ({ name: playerName, ...getPlayerScore(playerName) }))
            }))
        };
        const updated = [...tournamentHistory, tournamentData];
        setTournamentHistory(updated);
        localStorage.setItem('fantasyGolfTournaments', JSON.stringify(updated));
        alert(`‚úÖ "${tournamentInfo.name}" saved!`);
    };

    const deleteTournament = (tournamentId) => {
        if (confirm('Delete this tournament?')) {
            const updated = tournamentHistory.filter(t => t.id !== tournamentId);
            setTournamentHistory(updated);
            localStorage.setItem('fantasyGolfTournaments', JSON.stringify(updated));
            setSelectedHistoryId(null);
        }
    };

    const calculateSeasonStandings = () => {
        return teams.map(team => {
            let totalScore = 0, wins = 0, top3 = 0;
            tournamentHistory.forEach(tournament => {
                const teamScore = tournament.teamScores.find(ts => ts.teamId === team.id);
                if (teamScore) {
                    totalScore += teamScore.score;
                    const sortedScores = [...tournament.teamScores].sort((a, b) => b.score - a.score);
                    const position = sortedScores.findIndex(ts => ts.teamId === team.id);
                    if (position === 0) wins++;
                    if (position < 3) top3++;
                }
            });
            return { ...team, totalScore, tournamentsPlayed: tournamentHistory.length, avgScore: tournamentHistory.length > 0 ? (totalScore / tournamentHistory.length).toFixed(1) : 0, wins, top3 };
        }).sort((a, b) => b.totalScore - a.totalScore);
    };

    const sortedTeams = [...teams].sort((a, b) => calculateTeamScore(b) - calculateTeamScore(a));
    const seasonStandings = calculateSeasonStandings();
    const selectedTournament = tournamentHistory.find(t => t.id === selectedHistoryId);

    return (
        <div className="min-h-screen bg-gradient-to-br from-emerald-900 via-green-900 to-teal-900 p-6">
            <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-2xl shadow-2xl p-2 mb-6">
                    <div className="flex gap-2">
                        <button onClick={() => setCurrentTab('live')} className={`flex-1 flex items-center justify-center gap-2 px-6 py-4 rounded-xl font-bold transition ${currentTab === 'live' ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                            <Trophy className="w-6 h-6" /><span>Current Tournament</span>
                        </button>
                        <button onClick={() => setCurrentTab('history')} className={`flex-1 flex items-center justify-center gap-2 px-6 py-4 rounded-xl font-bold transition ${currentTab === 'history' ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                            <Calendar className="w-6 h-6" /><span>Previous ({tournamentHistory.length})</span>
                        </button>
                        <button onClick={() => setCurrentTab('season')} className={`flex-1 flex items-center justify-center gap-2 px-6 py-4 rounded-xl font-bold transition ${currentTab === 'season' ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                            <BarChart className="w-6 h-6" /><span>Season Standings</span>
                        </button>
                    </div>
                </div>

                {currentTab === 'live' && (
                    <>
                        <div className="bg-gradient-to-r from-yellow-400 via-amber-400 to-yellow-500 rounded-2xl shadow-2xl p-8 mb-8">
                            <div className="flex items-center justify-between flex-wrap gap-6">
                                <div className="flex items-center gap-4">
                                    <Trophy className="w-12 h-12" />
                                    <div>
                                        <h1 className="text-4xl font-bold text-gray-900">Live Tournament</h1>
                                        <p className="text-xl text-gray-800 font-semibold mt-1">{tournamentInfo.name}</p>
                                        {tournamentInfo.isMajor && <span className="inline-block mt-2 px-3 py-1 bg-red-600 text-white text-sm font-bold rounded-full">MAJOR</span>}
                                    </div>
                                </div>
                                <div className="flex flex-col items-end gap-3">
                                    <div className="flex gap-3 flex-wrap">
                                        <button onClick={saveTournament} className="flex items-center gap-2 px-5 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition font-bold shadow-lg"><Save />Save</button>
                                        <button onClick={() => setAutoRefresh(!autoRefresh)} className={`px-5 py-3 rounded-xl font-bold transition shadow-lg ${autoRefresh ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-500 text-white hover:bg-gray-600'}`}>{autoRefresh ? 'üîÑ Auto ON' : '‚è∏Ô∏è Auto OFF'}</button>
                                        <button onClick={fetchLeaderboard} disabled={loading} className="flex items-center gap-2 px-5 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:bg-gray-400 transition font-bold shadow-lg"><RefreshCw className={loading ? 'animate-spin' : ''} />Refresh</button>
                                    </div>
                                    {lastUpdate && <p className="text-sm text-gray-900 font-semibold bg-white/30 px-3 py-1 rounded-lg">Updated: {lastUpdate.toLocaleTimeString()}</p>}
                                </div>
                            </div>
                        </div>
                        <div className="space-y-6">
                            {sortedTeams.map((team, index) => {
                                const teamScore = calculateTeamScore(team);
                                const madeCutCount = getTotalMadeCut(team);
                                const cutBonus = tournamentInfo.isMajor ? MADE_CUT_BONUS.major : MADE_CUT_BONUS.regular;
                                return (
                                    <div key={team.id} className="bg-white rounded-2xl shadow-2xl overflow-hidden">
                                        <div className={`p-8 text-white ${index === 0 ? 'bg-gradient-to-r from-yellow-500 to-yellow-600' : index === 1 ? 'bg-gradient-to-r from-gray-400 to-gray-600' : index === 2 ? 'bg-gradient-to-r from-orange-500 to-orange-700' : 'bg-gradient-to-r from-blue-600 to-blue-800'}`}>
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-6">
                                                    <div className="bg-white text-gray-900 rounded-full w-16 h-16 flex items-center justify-center text-3xl font-bold shadow-lg">{index === 0 ? 'üèÜ' : index + 1}</div>
                                                    <div>
                                                        <h2 className="text-3xl font-bold">{team.name}</h2>
                                                        <div className="flex items-center gap-4 mt-2 text-sm">
                                                            <span className="flex items-center gap-2 bg-white/20 px-3 py-1 rounded-lg"><Users />{madeCutCount}/6 Made Cut</span>
                                                            <span className="flex items-center gap-2 bg-white/20 px-3 py-1 rounded-lg"><TrendingUp />+{madeCutCount * cutBonus} Bonus</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-6xl font-bold">{teamScore}</div>
                                                    <div className="text-lg opacity-90 font-semibold">Points</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="p-8">
                                            <table className="w-full">
                                                <thead>
                                                    <tr className="border-b-2 border-gray-300">
                                                        <th className="text-left py-4 px-4 font-bold text-gray-700 text-lg">Player</th>
                                                        <th className="text-center py-4 px-4 font-bold text-gray-700 text-lg">Pos</th>
                                                        <th className="text-center py-4 px-4 font-bold text-gray-700 text-lg">Score</th>
                                                        <th className="text-center py-4 px-4 font-bold text-gray-700 text-lg">Status</th>
                                                        <th className="text-center py-4 px-4 font-bold text-gray-700 text-lg">Cut</th>
                                                        <th className="text-right py-4 px-4 font-bold text-gray-700 text-lg">Points</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {team.players.map((playerName, idx) => {
                                                        const playerData = getPlayerScore(playerName);
                                                        const positionPoints = getPositionPoints(playerData.position, tournamentInfo.isMajor);
                                                        const cutBonusPoints = playerData.madeCut ? cutBonus : 0;
                                                        return (
                                                            <tr key={idx} className="border-b border-gray-200 hover:bg-blue-50">
                                                                <td className="py-5 px-4 font-bold text-gray-900 text-lg">{playerName}</td>
                                                                <td className="text-center py-5 px-4 font-semibold text-gray-700">{playerData.position}</td>
                                                                <td className="text-center py-5 px-4 font-semibold text-gray-700">{playerData.score}</td>
                                                                <td className="text-center py-5 px-4 text-gray-600">{playerData.thru}</td>
                                                                <td className="text-center py-5 px-4">{playerData.madeCut ? <span className="inline-block px-3 py-2 bg-green-500 text-white text-sm font-bold rounded-lg">‚úì +{cutBonusPoints}</span> : <span className="text-gray-400 text-sm font-semibold">-</span>}</td>
                                                                <td className="text-right py-5 px-4">
                                                                    <div className="flex flex-col items-end">
                                                                        <span className={`font-bold text-3xl ${playerData.points > 0 ? 'text-green-600' : 'text-gray-400'}`}>{playerData.points}</span>
                                                                        {playerData.madeCut && positionPoints > 0 && <span className="text-sm text-gray-500 mt-1">({positionPoints} + {cutBonusPoints})</span>}
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </>
                )}

                {currentTab === 'history' && (
                    <>
                        {!selectedHistoryId ? (
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <h2 className="text-3xl font-bold text-gray-900 mb-6">Tournament History</h2>
                                {tournamentHistory.length === 0 ? (
                                    <div className="text-center py-12">
                                        <Calendar className="mx-auto mb-4 text-gray-400 w-16 h-16" />
                                        <p className="text-xl text-gray-600">No saved tournaments yet</p>
                                        <p className="text-gray-500 mt-2">Save a tournament from the Current Tournament tab</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {tournamentHistory.slice().reverse().map(tournament => {
                                            const winner = tournament.teamScores.sort((a, b) => b.score - a.score)[0];
                                            return (
                                                <div key={tournament.id} onClick={() => setSelectedHistoryId(tournament.id)} className="border-2 border-gray-200 rounded-xl p-6 hover:border-blue-500 hover:shadow-lg transition cursor-pointer">
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div className="flex-1">
                                                            <h3 className="font-bold text-lg text-gray-900">{tournament.name}</h3>
                                                            <p className="text-sm text-gray-600">{new Date(tournament.date).toLocaleDateString()}</p>
                                                        </div>
                                                        {tournament.isMajor && <span className="px-2 py-1 bg-red-600 text-white text-xs font-bold rounded">MAJOR</span>}
                                                    </div>
                                                    <div className="mt-4 pt-4 border-t border-gray-200">
                                                        <p className="text-sm text-gray-600 mb-1">Winner</p>
                                                        <p className="font-bold text-gray-900">{winner.teamName}</p>
                                                        <p className="text-2xl font-bold text-green-600 mt-1">{winner.score} pts</p>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div>
                                <div className="bg-white rounded-2xl shadow-2xl p-6 mb-6">
                                    <button onClick={() => setSelectedHistoryId(null)} className="text-blue-600 hover:text-blue-800 font-semibold mb-4">‚Üê Back to All Tournaments</button>
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <h2 className="text-3xl font-bold text-gray-900">{selectedTournament.name}</h2>
                                            <p className="text-gray-600">{new Date(selectedTournament.date).toLocaleDateString()}{selectedTournament.isMajor && <span className="ml-2 px-2 py-1 bg-red-600 text-white text-xs font-bold rounded">MAJOR</span>}</p>
                                        </div>
                                        <button onClick={() => deleteTournament(selectedTournament.id)} className="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"><Trash />Delete</button>
                                    </div>
                                </div>
                                <div className="space-y-6">
                                    {selectedTournament.teamScores.sort((a, b) => b.score - a.score).map((teamScore, index) => (
                                        <div key={teamScore.teamId} className="bg-white rounded-2xl shadow-xl overflow-hidden">
                                            <div className={`p-6 ${index === 0 ? 'bg-gradient-to-r from-yellow-400 to-amber-500' : index === 1 ? 'bg-gradient-to-r from-gray-300 to-gray-400' : index === 2 ? 'bg-gradient-to-r from-orange-500 to-orange-600' : 'bg-gradient-to-r from-blue-500 to-blue-600'} text-white`}>